*** Settings ***
Documentation     NOTE:
...               add note here
Suite Setup       Setup_suite
Force Tags        windows
Test Template     Rename a database
Resource          ../../resources/keywords.txt
Resource          ../../resources/context.txt

*** Variables ***
${TEMP_DB_NAME}    DB_TEST_RENAME_NOK

*** Test Cases ***    Username             Password             JDBC Connection String    JDBC Driver JAR URI    JDBC Driver Class    Connection Interval    No of Connection Retries    Old DB Name            New DB Name      Fail if old DB not exits    Fail if new DB exits    RETCODE    STATUS
Wrong User Input Should Fail
                      ${_DB_USERNAME}_a    ${_DB_PASSWORD}      ${_CONN_STRING}           ${_JAR}                ${_CLASS}            ${_INTRVL}             ${_RETRY}                   ${TEMP_DB_NAME}        DB_RENAME_NEW    NO                          NO                      1          ${ENDED_NOK}

Wrong Password Input Should Fail
                      ${_DB_USERNAME}      ${_DB_PASSWORD}_b    ${_CONN_STRING}           ${_JAR}                ${_CLASS}            ${_INTRVL}             ${_RETRY}                   ${TEMP_DB_NAME}        DB_RENAME_NEW    NO                          NO                      1          ${ENDED_NOK}

Wrong JDBC Conn String Input Should Fail
                      ${_DB_USERNAME}      ${_DB_PASSWORD}      ${_CONN_STRING}_c         ${_JAR}                ${_CLASS}            ${_INTRVL}             ${_RETRY}                   ${TEMP_DB_NAME}        DB_RENAME_NEW    NO                          NO                      1          ${ENDED_NOK}

Wrong JDBC Driver JAR Input Should Fail
                      ${_DB_USERNAME}      ${_DB_PASSWORD}      ${_CONN_STRING}           ${_JAR}_d              ${_CLASS}            ${_INTRVL}             ${_RETRY}                   ${TEMP_DB_NAME}        DB_RENAME_NEW    NO                          NO                      1          ${ENDED_NOK}

Wrong JDBC Driver Class Input Should Fail
                      ${_DB_USERNAME}      ${_DB_PASSWORD}      ${_CONN_STRING}           ${_JAR}                ${_CLASS}_e          ${_INTRVL}             ${_RETRY}                   ${TEMP_DB_NAME}        DB_RENAME_NEW    NO                          NO                      1          ${ENDED_NOK}

Wrong Old DB Name Input Should Fail
                      ${_DB_USERNAME}      ${_DB_PASSWORD}      ${_CONN_STRING}           ${_JAR}                ${_CLASS}            ${_INTRVL}             ${_RETRY}                   ${TEMP_DB_NAME}_aaa    DB_RENAME_NEW    YES                         YES                     1          ${ENDED_NOK}

*** Keywords ***
Rename a database
    [Arguments]    ${username}    ${password}    ${jdbc_conn}    ${jdbc_jar}    ${jdbc_class}    ${interval}
    ...    ${retries}    ${db_name}    ${db_new_name}    ${fail_if_new_exists}    ${fail_if_not_exists}    ${returnCode}
    ...    ${returnStatus}
    Init Action    ${ACTION_RENAME_DB}
    Action Set    ${PRT_RENAME_DB_USERNAME}    ${username}
    Action Set    ${PRT_RENAME_DB_PASSWORD}    ${password}
    Action Set    ${PRT_RENAME_DB_JDBC_CONN_STRING}    ${jdbc_conn}
    Action Set    ${PRT_RENAME_DB_DRIVER_JAR}    ${jdbc_jar}
    Action Set    ${PRT_RENAME_DB_DRIVER_CLAS}    ${jdbc_class}
    Action Set    ${PRT_DROP_DB_CONN_INTRVL}    ${interval}
    Action Set    ${PRT_RENAME_DB_CONN_RETRY}    ${retries}
    Action Set    ${PRT_RENAME_DB_OLD_DATABASE_NAME}    ${db_name}
    Action Set    ${PRT_RENAME_DB_NEW_DATABASE_NAME}    ${db_new_name}
    Action Set    ${PRT_RENAME_DB_FAIL_OLD_DB_NOT_EXISTS}    ${fail_if_not_exists}
    Action Set    ${PRT_RENAME_DB_FAIL_NEW_DB_EXISTS}    ${fail_if_new_exists}
    Action Execute
    Action Report Should Be Found
    Action Return Code Should Not Equal    ${returnCode}
    Action Return Status Should Be    ${returnStatus}
    #Drop Database    ${_DB_USERNAME_AT}    ${_DB_PASSWORD_AT}    ${_CONN_STRING_AT}    ${_JAR}    ${_CLASS}    ${_INTRVL}
    #...    ${_RETRY}    ${_DB_NAME_AT}_NEW    NO    0    ${ENDED_OK}

Setup_suite
    [Documentation]    TODO: Write all steps need prepare before testing here
    Log    Start testing for Rename a database
    Drop Database    ${_DB_USERNAME}    ${_DB_USERNAME}    ${_CONN_STRING}    ${_JAR}    ${_CLASS}    ${_INTRVL}
    ...    ${_RETRY}    ${TEMP_DB_NAME}    NO    0    ${ENDED_OK}
    Create Database    ${_DB_USERNAME}    ${_DB_PASSWORD}    ${_CONN_STRING}    ${_JAR}    ${_CLASS}    ${_INTRVL}
    ...    ${_RETRY}    ${TEMP_DB_NAME}    ${EMPTY}    ${EMPTY}    ${EMPTY}    NO
    ...    OFF    OFF    0    ${ENDED_OK}
