*** Settings ***
Documentation     This is high level keywords that will be used by local test cases
Resource          messages.txt
Resource          context.txt
Library           com.automic.robot.itpa.ItpaLibrary

*** Key Words ***
Init Action
    [Arguments]    ${actionName}
    Action Create    ${actionName}
    Action Set    ${PROMPTSET_AGENT}    ${_AGENT}
    Action Set    ${PROMPTSET_LOGIN}    ${_LOGIN}

Action Report Should Contain
    [Arguments]    ${text}
    ${report} =    Action Get Report
    Should Contain    ${report}    ${text}

Action Report Should Be Found
    ${report} =    Action Get Report
    Should Not Be Empty    ${report}

Action Report Should Not Be Found
    ${report} =    Action Get Report
    Should Be Empty    ${report}

Action Return Code Should Be
    [Arguments]    ${code}
    ${returnCode}=    Action Get Variable    Return code
    Should Be Equal    ${returnCode}    ${code}

Action Return Code Should Not Equal
    [Arguments]    ${code}
    ${returnCode}=    Action Get Variable    Return code
    Should Not Be Equal    ${returnCode}    ${code}

Action Return Status Should Be
    [Arguments]    ${status}
    ${returnStatus}=    Action Get Variable    Status
    Should Be Equal    ${returnStatus}    ${status}

Action Return Variable Should Be
    [Arguments]    ${variableValue}
    ${out}=    Action Get Variable    ${variableName}
    Should Be Equal    ${out}    ${variableValue}

Action Return Variable Should Be Equal As Integers
    [Arguments]    ${variableValue}
    ${out}=    Action Get Variable    ${variableName}
    Should Be Equal As Integers    ${out}    ${variableValue}

MSSQL Common Setting
    Action Set    ${PRT_CREATE_USER_DB_USERNAME_LG}    ${DB_USERNAME}
    Action Set    ${PRT_CREATE_USER_DB_PASSWORD_LG}    ${DB_PASSWORD}
    Action Set    ${PRT_CREATE_USER_DB_JDBC_CONN_STRING}    ${CONN_STRING}
    Action Set    ${PRT_CREATE_USER_DB_DRIVER_JAR}    ${JAR}
    Action Set    ${PRT_CREATE_USER_DB_DRIVER_CLASS}    ${CLASS}
    Action Set    ${PRT_CREATE_USER_DB_TNSNAMES_ORA}    ${ORA}
    Action Set    ${PRT_CREATE_USER_DB_CONN_INTRVL}    ${INTRVL}

Drop Database
    [Arguments]    ${username}    ${password}    ${jdbc_conn}    ${jdbc_jar}    ${jdbc_class}    ${interval}
    ...    ${retries}    ${db_name}    ${fail_if_not_exists}    ${returnCode}    ${returnStatus}
    Init Action    ${ACTION_DROP_DB}
    Action Set    ${PRT_DROP_DB_USERNAME}    ${username}
    Action Set    ${PRT_DROP_DB_PASSWORD}    ${password}
    Action Set    ${PRT_DROP_DB_JDBC_CONN_STRING}    ${jdbc_conn}
    Action Set    ${PRT_DROP_DB_DRIVER_JAR}    ${jdbc_jar}
    Action Set    ${PRT_DROP_DB_DRIVER_CLASS}    ${jdbc_class}
    Action Set    ${PRT_DROP_DB_CONN_INTRVL}    ${interval}
    Action Set    ${PRT_DROP_DB_CONN_RETRY}    ${retries}
    Action Set    ${PRT_DROP_DB_DROP_DBNAME}    ${db_name}
    Action Set    ${PRT_DROP_DB_FAIL_DB_NOT_EXISTS}    ${fail_if_not_exists}
    Action Execute
    Action Return Code Should Be    ${returnCode}
    Action Return Status Should Be    ${returnStatus}

Create Database
    [Arguments]    ${username}    ${password}    ${jdbc_conn}    ${jdbc_jar}    ${jdbc_class}    ${interval}
    ...    ${retries}    ${db_name}    ${file_spec}    ${file_group_spec}    ${log_on_file_spec}    ${fail_if_exists}
    ...    ${trust_worthy_on}    ${db_changing_on}    ${returnCode}    ${returnStatus}
    Init Action    ${ACTION_CREATE_DB}
    Action Set    ${PRT_CREATE_DB_USERNAME}    ${username}
    Action Set    ${PRT_CREATE_DB_PASSWORD}    ${password}
    Action Set    ${PRT_CREATE_DB_JDBC_CONN}    ${jdbc_conn}
    Action Set    ${PRT_CREATE_DB_DRIVER_JAR}    ${jdbc_jar}
    Action Set    ${PRT_CREATE_DB_DRIVER_CLASS}    ${jdbc_class}
    Action Set    ${PRT_CREATE_DB_CONN_INTRVL}    ${interval}
    Action Set    ${PRT_CREATE_DB_CONN_RETRY}    ${retries}
    Action Set    ${PRT_CREATE_DB_CREATE_DB_NAME}    ${db_name}
    Action Set    ${PRT_CREATE_DB_FILE_SPEC}    ${file_spec}
    Action Set    ${PRT_CREATE_DB_FILEGROUP_SPEC}    ${file_group_spec}
    Action Set    ${PRT_CREATE_DB_LOG_ON_FILE_SPEC}    ${log_on_file_spec}
    Action Set    ${PRT_CREATE_DB_FAIL_IF_DB_EXISTS}    ${fail_if_exists}
    Action Set    ${PRT_CREATE_DB_TRUSTWORTHY_ON}    ${trust_worthy_on}
    Action Set    ${PRT_CREATE_DB_DBCHAINING_ON}    ${db_changing_on}
    Action Execute
    Action Return Code Should Be    ${returnCode}
    Action Return Status Should Be    ${returnStatus}

Backup Database
    [Arguments]    ${username}    ${password}    ${jdbc_conn}    ${jdbc_jar}    ${jdbc_class}    ${interval}
    ...    ${retries}    ${db_name}    ${file_to_include}    ${file_group_to_include}    ${target_disks}    ${minor_disks}
    ...    ${target_tapes}    ${minor_tapes}    ${differential}    ${common_only}    ${description}    ${backupset_name}
    ...    ${expires}    ${expire_date}    ${retain_days}    ${mediaset_init}    ${mediaset_skip}    ${mediaset_format}
    ...    ${mediaset_description}    ${name_of_media}    ${media_blocksize}    ${datatransfer_blockcount}    ${datatransfer_maximum}    ${error_management_checksum}
    ...    ${stop_on_error}    ${tape_rewind}    ${tape_unload}    ${returnCode}    ${returnStatus}
    Init Action    ${ACTION_DB_BACKUP}
    Init Action    ${ACTION_DB_BACKUP}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_USERNAME}    ${username}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_PASSWORD}    ${password}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_JDBC_CONN_STRING}    ${jdbc_conn}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_DRIVER_JAR}    ${jdbc_jar}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_DRIVER_CLASS}    ${jdbc_class}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_CONN_INTRVL}    ${interval}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_CONN_RETRY}    ${retries}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_BACKUP_DATABASE_NAME}    ${db_name}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_BACKUP_FILES}    ${file_to_include}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_BACKUP_FILEGROUPS}    ${file_group_to_include}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_BACKUP_TO_DISKS}    ${target_disks}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_MIRROR_TO_DISKS}    ${minor_disks}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_BACKUP_TO_TAPES}    ${target_tapes}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_MIRROR_TO_TAPES}    ${minor_tapes}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_BACKUPSET_DIFF}    ${differential}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_BACKUPSET_COPY_ONLY}    ${common_only}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_BACKUPSET_DESCRIPTION}    ${description}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_BACKUPSET_NAME}    ${backupset_name}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_BACKUP_EXPIRE_ON_DATE}    ${expires}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_BACKUP_EXPIRE_DATE}    ${expire_date}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_BACKUPSET_RETAIN_DAYS}    ${retain_days}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_MEDIASET_INIT}    ${mediaset_init}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_MEDIASET_SKIP}    ${mediaset_skip}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_MEDIASET_FORMAT}    ${mediaset_format}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_MEDIASET_DSCR}    ${mediaset_description}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_MEDIASET_MEDIANAME}    ${name_of_media}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_MEDIASET_BLOCKSIZE}    ${media_blocksize}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_DATATF_BUFFERCOUNT}    ${datatransfer_blockcount}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_DATATF_MAXTRFSIZE}    ${datatransfer_maximum}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_ERRMGMT_CHECKSUM}    ${error_management_checksum}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_ERRMGMT_STOP_ON_ERR}    ${stop_on_error}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_TAPE_REWIND}    ${tape_rewind}
    Action Set    ${PRT_CREATE_DB_BACKUP_DB_TAPE_UNLOAD}    ${tape_unload}
    Action Execute
    Action Return Code Should Be    ${returnCode}
    Action Return Status Should Be    ${returnStatus}

Create Login
    [Arguments]    ${OK_NOK}    ${FLAG}    ${username}    ${password}    ${jdbc_conn}    ${jdbc_jar}
    ...    ${jdbc_class}    ${interval}    ${retries}    ${db_name}    ${login_name}    ${use_win_login}
    ...    ${login_pass}    ${pass_must_change}    ${check_pass_exp}    ${check_pass_policy}    ${fail_if_exists}    ${returnCode}
    ...    ${returnStatus}
    ${_CURRENT_TIMESTAMP_}    Get Time    epoch
    Run Keyword If    '${FLAG}' == 'TEST'    Set Suite Variable    ${login_with_timestamp}    ${login_name}${_CURRENT_TIMESTAMP_}
    Init Action    ${ACTION_CREATE_LOGIN}
    Action Set    ${PRT_CREATE_LOGIN_USERNAME}    ${username}
    Action Set    ${PRT_CREATE_LOGIN_PASSWORD}    ${password}
    Action Set    ${PRT_CREATE_LOGIN_JDBC_CONN}    ${jdbc_conn}
    Action Set    ${PRT_CREATE_LOGIN_DRIVER_JAR}    ${jdbc_jar}
    Action Set    ${PRT_CREATE_LOGIN_DRIVER_CLASS}    ${jdbc_class}
    Action Set    ${PRT_CREATE_LOGIN_CONN_INTRVL}    ${interval}
    Action Set    ${PRT_CREATE_LOGIN_CONN_RETRY}    ${retries}
    Action Set    ${PRT_CREATE_LOGIN_DATABASE_NAME}    ${db_name}
    Run Keyword If    '${use_win_login}' == 'NO'    Action Set    ${PRT_CREATE_LOGIN_LOGIN_NAME}    ${login_with_timestamp}
    Run Keyword If    '${use_win_login}' == 'YES'    Action Set    ${PRT_CREATE_LOGIN_LOGIN_NAME}    ${login_name}
    Action Set    ${PRT_CREATE_LOGIN_USE_WIN_LOGIN}    ${use_win_login}
    Action Set    ${PRT_CREATE_LOGIN_LOGIN_PWD}    ${login_pass}
    Action Set    ${PRT_CREATE_LOGIN_PWD_MUST_CHNG}    ${pass_must_change}
    Action Set    ${PRT_CREATE_LOGIN_CHK_EXPR}    ${check_pass_exp}
    Action Set    ${PRT_CREATE_LOGIN_CHK_POLICY}    ${check_pass_policy}
    Action Set    ${PRT_CREATE_LOGIN_FAIL_IF_EXIST}    ${fail_if_exists}
    Action Execute
    Action Report Should Be Found
    Action Return Code Should Be    ${returnCode}
    Action Return Status Should Be    ${returnStatus}
